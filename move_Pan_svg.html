<html>
    <title>OpenSeadragon Overlay Demo</title>
    <script type="text/javascript" src='openseadragon.js'></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.js"></script>
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <style type="text/css">

        .openseadragon1 {
            width: 800px;
            height: 600px;
        }
    </style>
</head>
<body>
    <div id="contentDiv" class="openseadragon1"></div>
     <input type="button" value="OK " id="toggle-overlay" onclick="addAno()">
  <input type="button" value="Count " id="t1">

    <script type="text/javascript">

        var viewer1 = OpenSeadragon({
  
            id: "contentDiv",
            prefixUrl: "images/",
            tileSources: "tall.dzi",

        });
viewer1.addHandler('open', function(event){
	var elt = document.createElement("div");
	elt.className = "overlay";
    elt.id = "overlay_T";
	var dimensions = viewer1.source.dimensions;
	viewer1.addOverlay({
		element: elt,
		location: viewer1.viewport.imageToViewportRectangle( new OpenSeadragon.Rect(0, 0, dimensions.x, dimensions.y) )
	});
});

var set,s1,paper;
    viewer1.addHandler('add-overlay', function(event){
	 paper = Raphael(event.element);
 //paper=Raphael("filterDiv", 1100, 1000);
    paper.canvas.setAttribute('id', 'SvgElement');
    paper.canvas.setAttribute('width', 5000);
     paper.canvas.setAttribute('height', 5000);   
    
	set = paper.set();
	//set.push(  paper.circle(196,202.5,200).animate({fill: "#223fa3", "fill-opacity": 0.5},2000));

 
var aa=paper.circle(300,900,600);
aa.node.id = 'c1';
aa.node.setAttribute('onclick',"selected(this.id)");
aa.node.setAttribute('fill',"#223fa3");
aa.node.setAttribute('fill-opacity',0.5);
set.push(aa);
var aa=paper.circle(500,1000,600);
aa.node.id = 'c2';
aa.node.setAttribute('onclick',"selected(this.id)");
aa.node.setAttribute('fill',"#223fa3");
aa.node.setAttribute('fill-opacity',0.5);
set.push(aa);
//var s1=set.push(paper.rect(596,202.5,100,100).animate({fill: "#223fa3", "fill-opacity": 0.5}, 2000));
var a=paper.rect(600,600,200,100);
a.node.id = 'rect1';
//a.node.setAttribute("class","track");
a.node.setAttribute('onclick',"selected(this.id)");
a.node.setAttribute('fill',"#223fa3");
a.node.setAttribute('fill-opacity',0.5);
set.push(a);
var a=paper.rect(800,600,500,600);
a.node.id = 'rect2';
a.node.setAttribute('onclick',"selected(this.id)");
a.node.setAttribute('fill',"#223fa3");
a.node.setAttribute('fill-opacity',0.5);
set.push(a);
var a=paper.ellipse(796,302,500,200);
a.node.id = 'e1';
a.node.setAttribute('onclick',"selected(this.id)");
a.node.setAttribute('fill',"#223fa3");
a.node.setAttribute('fill-opacity',0.5);
set.push(a);
/*
var paper = Raphael(0,0,300,300);
var d = "M 10,30 L 60,30 L 10,80 L 60,80";
var mark = paper.path(d);
mark.attr({
    "stroke": "#F00",
    "stroke-width": 3
});
*/
 var tri = paper.path( ["M", 100, 100, "L", 300, 100 ]).attr("fill", "red");
 tri.node.id = 'l1';
set.push(tri);
//set.push(paper.rect(596,602,200,100).attr("id","SvgElement").animate({fill: "#223fa3", "fill-opacity": 0.5}, 2000));	 


   
transformSet( set )
});


function addAno()
{
 //set.push(paper.rect(x,y,5,700,700).animate({fill: "#223fa3", "fill-opacity": 0.5,id:"d1"}, 2000));
/*
var a=paper.rect(xx,yy,300,300);
a.node.id = 'rect3';
a.node.setAttribute('onclick',"selected(this.id)");
a.node.setAttribute('fill',"#223fa3");
a.node.setAttribute('fill-opacity',0.5);
set.push(a);
*/
$('#SvgElement').append('<polygon points="100,100 150,25 150,75 200,0" stroke="7" fill="red" stroke="black" />');
}
//paper.rect(0, 0, 300, 300, 0).attr({fill: "orange", stroke: "none"}).node.setAttribute('id', 'myElement');
viewer1.addHandler('animation', function(event){
   viewer1.zoomPerClick = 1;  // for  disabled zooming when click( if want to On value will be 2)
	transformSet( set )

document.getElementById("SvgElement").setAttribute("transform",'matrix(0.18 0 0 0.18 255.01 525.58)');
});
  
var z1;
var preZoom;
var ss1;
var ss2;

//------------------------
/*
document.getElementById('animation').addEventListener('click', printPosition)

function getPosition(e) {
  var rect = e.target.getBoundingClientRect();
  var x = e.clientX - rect.left;
  var y = e.clientY - rect.top;
  return x
}

function printPosition(e) {
  var position = getPosition(e);
  //document.getElementById('area').value = 'X: ' + position.x + ' Y: ' + position.y;
  console.log('X: ' + position.x + ' Y: ' + position.y);
}
*/


viewer1.addHandler('canvas-click', function(event) {
  
    // The canvas-click event gives us a position in web coordinates.
    var webPoint = event.position;

    // Convert that to viewport coordinates, the lingua franca of OpenSeadragon coordinates.
    var viewportPoint = viewer1.viewport.pointFromPixel(webPoint);

    // Convert from viewport coordinates to image coordinates.
    var imagePoint = viewer1.viewport.viewportToImageCoordinates(viewportPoint);

    // Show the results.
    console.log(webPoint.toString(), viewportPoint.toString(), imagePoint.toString());
});


//---------------------------------



function transformSet( el ){
 
	var zoom =z1= viewer1.viewport.viewportToImageZoom( viewer1.viewport.getZoom(true));
	
el.transform( 'S'+zoom+','+zoom+',0,0' );
  
}



var canvasHandler = $("#SvgElement");
   var matrixval=0;
   var xVal,yVal;
function selected(id)
{  
   
    idd=id;
    start=true;
    var s=$('#'+idd).attr('transform');   
  }
var idd="";
var start;
  var xx1=0;
  var yy1=0;
   var xx,yy;

//contentDiv
//annotation
$("#annotation").mousemove(function (e) {   
        xx = e.offsetX;
        yy = e.offsetY;       
                 
              if(idd!="")
              {             
           if(idd=="c1" || idd=="c2")
           {
            var x1=xx-20;
            var y1=yy-20;
               var matrix=$('#'+idd).attr('transform');
               var s=matrix.split(" ");                
                var s1=xx1=x1;
                yy1=y1;
                var s2=y1+")";
                var ss=s[0]+" "+s[1]+" "+s[2]+" "+s[3]+" "+s1+" "+s2;
               matrixval=ss;              
            document.getElementById(idd).setAttribute("transform",ss);

             //xVal=s1;yVal=(y1+ss1)+")";
            document.getElementById(idd).setAttribute('cy',0);
            document.getElementById(idd).setAttribute('cx',0);
           }
           else
           {
           //document.getElementById(idd).setAttribute('x',xx);
            //document.getElementById(idd).setAttribute('y',yy);
           
            var matrix=$('#'+idd).attr('transform');
               var s=matrix.split(" ");                
                 var z2=z1*100;
                var s1=xx;                
                var s2=(yy+z2)+")";
                            
                var ss=s[0]+" "+s[1]+" "+s[2]+" "+s[3]+" "+s1+" "+s2;
               xVal=s1;yVal=s2;
               matrixval=ss;
            document.getElementById(idd).setAttribute("transform", ss);          
        }
       }
       else
       {
         
       }



        var tracker = new OpenSeadragon.MouseTracker({
            element: viewer1.container,
            moveHandler: function(event) {
                var webPoint = event.position;
                var viewportPoint = viewer1.viewport.pointFromPixel(webPoint);
                var imagePoint = viewer1.viewport.viewportToImageCoordinates(viewportPoint);
                var zoom = viewer1.viewport.getZoom(true);
                var imageZoom = viewer1.viewport.viewportToImageZoom(zoom);

               console.log(imagePoint.x+" : "+imagePoint.y);
               document.getElementById("c1").setAttribute('cy',imagePoint.y);
            document.getElementById("c1").setAttribute('cx',imagePoint.x);
                  
            }
        });  

        tracker.setTracking(true);  

      

});





/*


    viewer1.addHandler('open', function() {

        var tracker = new OpenSeadragon.MouseTracker({
            element: viewer1.container,
            moveHandler: function(event) {
                var webPoint = event.position;
                var viewportPoint = viewer1.viewport.pointFromPixel(webPoint);
                var imagePoint = viewer1.viewport.viewportToImageCoordinates(viewportPoint);
                var zoom = viewer1.viewport.getZoom(true);
                var imageZoom = viewer1.viewport.viewportToImageZoom(zoom);

               
                  
            }
        });  

        tracker.setTracking(true);  

        viewer1.addHandler('animation', ff);   
    });
*/
function ff()
{
  console.log("jj");
}



    </script>
</body>
</html>
